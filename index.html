<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<html>
    <head>
        <title>makcro</title>
        <meta charset="utf-8" />
        <style>
            .original {
                position: absolute;
                width: 100%;
                height: 100%;
                font-family: 'brass mono', 'fira code';
                font-size: large;
                outline: none;
                caret-color: gray;
                word-wrap: break-word;
            }
            #dummy {
                color: white;
                word-wrap: break-word;
            }
            #board {
                z-index: 11;
                background: transparent;
                color: transparent;
                word-wrap: break-word;
            }
            .original span.highlighted {
                color: red;
            }
        </style>
    </head>
    <body style="margin: 0%; background-color: rgb(26, 26, 26);">
        <div
            id="board"
            class="original"
            contenteditable="true"
            spellcheck="false"
            onblur="this.focus()"
            autofocus
        ></div>
        <div id="dummy" class="original"></div>
        <script type="text/javascript">
            let initClient = () => {
                gapi.client
                    .init({
                        apiKey: 'AIzaSyAoGzRKCqNlCalMF9nKk9UxGtBNygY8k6M',
                        clientId:
                            '18830208597-7qaf4bhu75likfndk231vmaul0ckel01.apps.googleusercontent.com',
                        discoveryDocs: [
                            'https://docs.googleapis.com/$discovery/rest?version=v1',
                            'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'
                        ],
                        scope: 'https://www.googleapis.com/auth/drive'
                    })
                    .then(
                        () => {
                            if (
                                !gapi.auth2.getAuthInstance().isSignedIn.get()
                            ) {
                                gapi.auth2.getAuthInstance().signIn()
                            }
                            printDocTitle()
                        },
                        error => {
                            console.log(JSON.stringify(error, null, 2))
                        }
                    )
            }
            function printDocTitle() {
                gapi.client.drive.files.create(
                    {
                        resource: {
                            name: 'makcro'
                        },
                        media: {
                            mimeType: 'application/vnd.google-apps.document',
                            body: ''
                        },
                        fields: 'id'
                    },
                    function(err, file) {
                        if (err) {
                            // Handle error
                            console.error(err)
                        } else {
                            console.log('File Id: ', file.id)
                        }
                    }
                )
                gapi.client.docs.documents
                    .get({
                        documentId:
                            '195j9eDD3ccgjQRttHhJPymLJUCOUjs-jmwTrekvdjFE'
                    })
                    .then(
                        function(response) {
                            var doc = response.result
                            var title = doc.title
                            console.log(
                                'Document "' + title + '" successfully found.'
                            )
                        },
                        function(response) {
                            console.log(
                                'Error: ' + response.result.error.message
                            )
                        }
                    )
            }
        </script>
        <script
            async
            defer
            src="https://apis.google.com/js/api.js"
            onload="this.onload=function(){};gapi.load('client:auth2', initClient)"
            onreadystatechange="if (this.readyState === 'complete') this.onload()"
        ></script>
    </body>
    <script>
        let keyWords = ['select', 'insert', 'update', 'from', 'where']
        let regexFromMyArray = new RegExp(keyWords.join('|'), 'ig')
        let u = () => {
            document.getElementById('dummy').innerHTML = $('#board')
                .html()
                .replace(regexFromMyArray, function(str) {
                    return '<span class="highlighted">' + str + '</span>'
                })
        }
        $('#board').on('input', u)
        u()
        let target = $('#dummy')
        $('#board').scroll(function() {
            target
                .prop('scrollTop', this.scrollTop)
                .prop('scrollLeft', this.scrollLeft)
        })
    </script>
</html>
