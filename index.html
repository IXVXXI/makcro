<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<html>
    <head>
        <title>makcro</title>
        <meta charset="utf-8" />
        <style>
            .original {
                position: absolute;
                width: 100%;
                height: 100%;
                font-family: 'brass mono', 'fira code';
                font-size: large;
                outline: none;
                caret-color: gray;
                word-wrap: break-word;
            }
            #dummy {
                color: white;
                word-wrap: break-word;
            }
            #board {
                z-index: 11;
                background: transparent;
                color: transparent;
                word-wrap: break-word;
            }
            .original span.highlighted {
                color: red;
            }
        </style>
    </head>
    <body style="margin: 0%; background-color: rgb(26, 26, 26);">
        <div
            id="board"
            class="original"
            contenteditable="true"
            spellcheck="false"
            onblur="this.focus()"
            autofocus
        ></div>
        <div id="dummy" class="original"></div>
        <script type="text/javascript">
            let initClient = () => {
                gapi.client
                    .init({
                        apiKey: 'AIzaSyAoGzRKCqNlCalMF9nKk9UxGtBNygY8k6M',
                        clientId:
                            '18830208597-7qaf4bhu75likfndk231vmaul0ckel01.apps.googleusercontent.com',
                        discoveryDocs: [
                            'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'
                        ],
                        scope: 'https://www.googleapis.com/auth/drive'
                    })
                    .then(
                        () => {
                            if (
                                !gapi.auth2.getAuthInstance().isSignedIn.get()
                            ) {
                                gapi.auth2.getAuthInstance().signIn()
                            }
                            listFiles()
                            uploadFile()
                        },
                        error => {
                            appendPre(JSON.stringify(error, null, 2))
                        }
                    )
            }
            let appendPre = message => {
                console.log(message)
            }
            let uploadFile = () => {
                gapi.client.drive.files
                    .create(
                        {
                            resource: {
                                name: 'TESTWORKED',
                                mimeType: 'application/vnd.google-apps.folder'
                            },
                            fields: 'id'
                        },
                        function(err, file) {
                            if (err) {
                                console.error(err)
                            } else {
                                console.log('Folder Id: ', file.id)
                            }
                        }
                    )
                    .execute()
            }
            let listFiles = () => {
                gapi.client.drive.files
                    .list({
                        pageSize: 10,
                        fields: 'nextPageToken, files(id, name, mimeType)'
                    })
                    .then(response => {
                        appendPre('Files:')
                        let files = response.result.files
                        if (files && files.length > 0) {
                            for (let i = 0; i < files.length; i++) {
                                let file = files[i]
                                if (
                                    file.mimeType ==
                                    'application/vnd.google-apps.folder'
                                ) {
                                    if (file.name == 'makcro') {
                                    }
                                }
                                appendPre(file.name + ' (' + file.id + ')')
                            }
                        } else {
                            appendPre('No files found.')
                        }
                    })
            }
        </script>
        <script
            async
            defer
            src="https://apis.google.com/js/api.js"
            onload="this.onload=function(){};gapi.load('client:auth2', initClient)"
            onreadystatechange="if (this.readyState === 'complete') this.onload()"
        ></script>
    </body>
    <script>
        let keyWords = ['select', 'insert', 'update', 'from', 'where']
        let regexFromMyArray = new RegExp(keyWords.join('|'), 'ig')
        let u = () => {
            document.getElementById('dummy').innerHTML = $('#board')
                .html()
                .replace(regexFromMyArray, function(str) {
                    return '<span class="highlighted">' + str + '</span>'
                })
        }
        $('#board').on('input', u)
        u()
        let target = $('#dummy')
        $('#board').scroll(function() {
            target
                .prop('scrollTop', this.scrollTop)
                .prop('scrollLeft', this.scrollLeft)
        })
    </script>
</html>
